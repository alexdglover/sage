{{ template "header" .}}
<h2>Cash Flow Report</h2>
<h3>{{ . }}</h3>
<div class="row">
  <div class="col-md-2"></div>
  <div class="col-md-8" style="max-height: 600px;">
    <div class="btn-group" style="width: 100%; padding-left: 10%; padding-right: 10%;" role="group" aria-label="date range buttons">
      <a type="button" class="btn {{ if eq .RelativeWindow "allTime" }}btn-dark{{else}}btn-outline-dark{{end}}" href="/cash-flow?relativeWindow=allTime">All time</a>
      <a type="button" class="btn {{ if eq .RelativeWindow "12" }}btn-dark{{else}}btn-outline-dark{{end}}" href="/cash-flow?relativeWindow=12">Last 12 months</a>
      <a type="button" class="btn {{ if eq .RelativeWindow "6" }}btn-dark{{else}}btn-outline-dark{{end}}" href="/cash-flow?relativeWindow=6">Last 6 months</a>
      <a type="button" class="btn {{ if eq .RelativeWindow "3" }}btn-dark{{else}}btn-outline-dark{{end}}" href="/cash-flow?relativeWindow=3">Last 3 months</a>
    </div>
    <canvas id="sankeyChart" style="width: 100%;"></canvas>
  </div>
  <div class="col-md-2"></div>
</div>

<script src="/assets/npm/chart.js@4.4.3/dist/chart.umd.js"></script>
<script src="/assets/npm/chartjs-chart-sankey@0.14.0/chartjs-chart-sankey.min.js"></script>
<script>
(function () {
  'use strict'
  var colors = {
    Income: "green",
    Savings: "green",
    Expenses: "red"
  };
  function getColor(txnType) {
    return colors[txnType] || 'black'; // Default color if not found
  }
  const data = {
    // labels: nodeLabels,
    datasets: [{
      label: 'Cash Flow',
      data: [
        { from: "Income", to: "Expenses", flow: {{ .TotalExpenses }} },
        {{ if .ShowSavings}}
        { from: "Income", to: "Savings", flow: {{ .Savings }} },
        {{ end}}
        {{ range $index, $expenseDatum := .Expenses }}
        { from: "Expenses", to: "{{ $expenseDatum.Name }}", flow: {{ $expenseDatum.Amount }} },
        {{ end }}
      ],
      colorFrom: (c) => getColor(c.dataset.data[c.dataIndex].from),
      colorTo: (c) => getColor(c.dataset.data[c.dataIndex].to),
      column: {
        "Savings": 1,
      },
      colorMode: 'gradient',
      borderWidth: 0
    }]
  };

  const ctx = document.getElementById('sankeyChart').getContext('2d');
  new Chart(ctx, {
    type: 'sankey',
    data: data,
    options: {
      plugins: {
        legend: { display: false },
        title: {
          display: true,
          text: 'Cash Flow Sankey Diagram'
        }
      },
      responsive: true,
      maintainAspectRatio: false,
      layout: {
        padding: 20
      },
      animation: false
    }
  });
})();
</script>
{{ template "footer"}}
